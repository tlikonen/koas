Arvosanatietokanta
==================

Koas-ohjelma käyttää PostgreSQL-tietokantajärjestelmää arvosanojen
tallentamiseen. Se on palvelinohjelmisto, johon asiakasohjelmat kuten
Koas ovat yhteydessä Internetin tekniikalla. Palvelinohjelmisto voi
toimia esimerkiksi omalla tietokoneella.

PostgreSQL täytyy asentaa tietokoneelle erikseen, ja Koas-ohjelmaa
varten täytyy luoda sopiva käyttäjätunnus ja tietokanta. Seuraavat
ohjeet neuvovat tietokannan valmistelun.

Tietokantapalvelimeen täytyy muodostaa yhteys ylläpitokäyttäjällä.
Sellainen on ainakin käyttäjä ”postgres”. Se käyttäjätunnus on olemassa
sekä käyttöjärjestelmässä että PostgreSQL:ssä.

    $ sudo -u postgres psql

    psql (15.12 (Debian 15.12-0+deb12u2))
    Type "help" for help.

    postgres=# 

”psql” on asiakasohjelma PostgreSQL:ään, ja sen avulla voi suorittaa
SQL-kielisiä tietokannan käskyjä. Kehote ”postgres=#” kertoo, minkä
nimiseen tietokantaan on parhaillaan yhteys.

Luodaan uusi tietokannan käyttäjätunnus ja salasana Koas-ohjelmaa
varten:

    postgres=# create user koas password 'salaisuus';

Myöhemmin salasanan voi vaihtaa seuraavalla komennolla. Komennon voi
suorittaa joko ylläpitotunnuksella kuten ”postgres” tai kyseisellä
käyttäjätunnuksella itsellään.

    postgres=# alter role koas password 'uusi-salaisuus';

Koas-ohjelma tarvitsee toimiakseen yhden ”skeeman” (schema) eli
nimiavaruuden jostakin tietokannasta. Se skeema voi olla osa jotakin
suurempaa tietokantaa, tai Koasia varten voi luoda ihan oman
tietokannan, jota ei mikään muu ohjelma käytä. Seuraavat ohjeet luovat
oman tietokannan Koasille.

Seuraavassa luodaan uusi tietokanta nimeltä ”koas”. Nimi voi olla mikä
hyvänsä muukin.

    postgres=# create database koas;

Otetaan yhteys uuteen tietokantaan:

    postgres=# \c koas

    You are now connected to database "koas" as user "postgres".
    koas=# 

Tähän uuteen koas-nimiseen tietokantaan luodaan skeema eli nimiavaruus
Koas-ohjelman taulukoille. Seuraavassa esimerkissä skeeman nimi on
”arvosanat”, mutta nimeksi voi valita muunkin.

    koas=# create schema arvosanat;

Seuraavaksi annetaan käyttäjätunnukselle ”koas” käyttöoikeuksia uuteen
tietokantaan ja sen sisältämään skeemaan. Tietokantaan annetaan
kirjautumisoikeus ja skeemaan käyttö- ja muokkausoikeudet.

Oikeus tietokantaan kirjautumiseen. Seuraavassa ensin mainittu ”koas” on
tietokannan nimi ja jälkimmäinen ”koas” on käyttäjätunnus.

    koas=# grant connect on database koas to koas;

Oikeus arvosanat-skeeman käyttöön ja muokkaamiseen:

    koas=# grant usage, create on schema arvosanat to koas;

Lopuksi asetetaan käyttäjätunnus ”koas” käyttämään skeemaa ”arvosanat”
tietokannassa ”koas”. Koas-ohjelma ei itse millään tavalla välitä, missä
skeemassa ja tietokannassa se toimii. Siksi seuraavalla komennolla
asetetaan tietokannassa muuttujan search_path arvoksi se skeema, jota
Koas-ohjelman halutaan käyttävän. Tämän muuttujan avulla Koas voidaan
asettaa käyttämään, mitä skeemaa hyvänsä.

    koas=# alter role koas in database koas set search_path to arvosanat;

Edellä ensimmäinen ”koas” on käyttäjätunnuksen nimi, toinen ”koas” on
tietokannan nimi, johon search_path-muuttujan asetus tulee voimaan.
Lopussa oleva ”arvosanat” on skeeman nimi.

Tietokannan asetukset ovat nyt valmiit. Psql-ohjelmasta voi poistua
komennolla ”\q”.

Uudella käyttäjätunnuksella kirjautumista voi kokeilla Psql-ohjelmalla
käyttöjärjestelmän komentotulkista. Seuraavassa komennossa valitsin ”-U”
määrittää käyttäjätunnuksen, ”-h” verkko-osoitteen, jossa
PostgreSQL-palvelin toimii, ja ”-d” nimen tietokannalle, johon
kirjaudutaan.

    $ psql -U koas -h localhost -d koas

Psql:n komentotulkissa voi komennolla ”\l” listata tietokannat,
komennolla ”\dn+” nykyisen tietokannan skeemat ja käyttöoikeudet,
komennolla ”\du” käyttäjätunnukset ja komennolla ”\drds”
käyttäjätunnusten asetuksia.

Ennen kuin Koas-ohjelma toimii, täytyy sen asetustiedostoon asettaa
tietokannan yhteysasetukset. Sitä varten on erillinen ohje. Kun
asetukset ovat kunnossa, Koas luo tarvitsemansa taulukot ja muut
tietokantaobjektit ensimmäisellä käynnistuskerralla.
